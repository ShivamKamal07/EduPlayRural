{% extends 'shared/base.html' %}
{% block title %}Grammar Challenge Game{% endblock %}

{% block content %}
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(#ffe6e6, #ffb3b3);
  text-align: center;
  overflow-x: hidden;
}
h1 {
  background-color: #d32f2f;
  color: white;
  margin: 0;
  padding: 20px;
  font-size: 32px;
}
/* Introduction card style */
.intro {
  background: linear-gradient(135deg, #f0e6ff, #d1b3ff);
  color: #4b0082;
  width: 80%;
  max-width: 700px;
  margin: 20px auto;
  padding: 25px;
  border-radius: 18px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}
.intro h2 {
  color: #6a1b9a;
}
.intro button {
  padding: 12px 30px;
  font-size: 18px;
  background: #6a1b9a;
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  margin-top: 20px;
  transition: 0.3s;
}
.intro button:hover {
  background: #4b0082;
}

#gameArea {
  display: none;
  position: relative;
  height: 500px;
  margin-top: 20px;
}
.bubble {
  position: absolute;
  background-color: #ff7043;
  color: white;
  border-radius: 50%;
  width: 120px;
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.bubble:hover {
  transform: scale(1.1);
}

.controls {
  margin-top: 20px;
}
.controls button {
  padding: 10px 20px;
  margin: 5px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
  background: #d32f2f;
  color: white;
  transition: 0.3s;
}
.controls button:hover {
  background: #9a0007;
}

#score {
  margin-top: 15px;
  font-size: 22px;
  font-weight: bold;
  color: #333;
}
#message {
  font-size: 26px;
  color: #1b5e20;
  font-weight: bold;
  margin-top: 10px;
  white-space: pre-line;
}
</style>

<h1>üìö Grammar Challenge Game</h1>

<div class="intro" id="intro">
  <h2>‡§™‡§∞‡§ø‡§ö‡§Ø</h2>
  <p>‡§á‡§∏ ‡§ñ‡•á‡§≤ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§π‡•à:</p>
  <ul style="text-align:left;">
    <li>‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§µ‡•ç‡§Ø‡§æ‡§ï‡§∞‡§£ (Grammar) ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡§¢‡§º‡•á‡§Ç‡•§</li>
    <li>‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§µ‡§æ‡§≤‡•á bubble ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</li>
    <li>‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡§∞ +10 ‡§Ö‡§Ç‡§ï, ‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡§∞ -5 ‡§Ö‡§Ç‡§ï‡•§</li>
    <li>‡§Ö‡§ß‡§ø‡§ï ‡§Ö‡§Ç‡§ï = ‡§¨‡•á‡§π‡§§‡§∞ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®‡•§</li>
  </ul>
  <button onclick="startGame()">‡§ñ‡•á‡§≤ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<div id="gameArea"></div>
<div id="score">Score: 0</div>
<div id="message"></div>

<div class="controls" id="controls" style="display:none;">
  <button onclick="stopGame()">Stop</button>
  <button onclick="backToIntro()">Back</button>
  <button onclick="restartLevel()">Restart</button>
</div>

<script>
const level1 = [
  { question: "‡§ï‡•å‡§® ‡§∏‡§æ ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§∏‡§π‡•Ä ‡§π‡•à?", options: ["‡§Æ‡•à‡§Ç ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å‡•§", "‡§Æ‡•à‡§Ç ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å‡•§", "‡§Æ‡•à‡§Ç ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§"], answer: "‡§Æ‡•à‡§Ç ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å‡•§" },
  { question: "‡§∏‡§π‡•Ä ‡§∂‡§¨‡•ç‡§¶ ‡§ö‡•Å‡§®‡•á‡§Ç: '‡§∞‡§æ‡§Æ ____ ‡§™‡§¢‡§º‡§§‡§æ ‡§π‡•à‡•§'", options: ["‡§Ö‡§ö‡•ç‡§õ‡§æ", "‡§Ö‡§ö‡•ç‡§õ‡•Ä", "‡§Ö‡§ö‡•ç‡§õ‡•á"], answer: "‡§Ö‡§ö‡•ç‡§õ‡§æ" },
  { question: "‡§∏‡§π‡•Ä ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§ï‡§æ ‡§ö‡§Ø‡§® ‡§ï‡§∞‡•á‡§Ç:", options: ["‡§µ‡§π ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§ó‡§à‡•§", "‡§µ‡§π ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§ó‡§Ø‡§æ‡•§", "‡§µ‡§π ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§ú‡§æ‡§§‡•á‡•§"], answer: "‡§µ‡§π ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§ó‡§Ø‡§æ‡•§" },
  { question: "‡§∏‡§π‡•Ä ‡§∞‡•Ç‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç: '‡§µ‡•á ‡§≤‡•ã‡§ó ____ ‡§Ü‡§è‡•§'", options: ["‡§∂‡§æ‡§¶‡•Ä", "‡§∂‡§æ‡§¶‡§ø‡§Ø‡§æ‡§Å", "‡§∂‡§æ‡§¶‡•Ä‡§Ø‡§æ‡§Å"], answer: "‡§∂‡§æ‡§¶‡•Ä" },
  { question: "‡§∏‡§π‡•Ä ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§ï‡§≤ ____ ‡§¶‡•á‡§ñ‡§æ‡•§'", options: ["‡§´‡§ø‡§≤‡•ç‡§Æ", "‡§´‡§ø‡§≤‡•ç‡§Æ‡•á‡§Ç", "‡§´‡§ø‡§≤‡•ç‡§Æ‡•ã‡§Ç"], answer: "‡§´‡§ø‡§≤‡•ç‡§Æ" }
];

const level2 = [
  { question: "‡§ï‡•å‡§® ‡§∏‡§æ ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§∏‡§π‡•Ä ‡§π‡•à?", options: ["‡§§‡•Å‡§Æ ‡§ñ‡•á‡§≤ ‡§∞‡§π‡•á ‡§π‡•ã‡•§", "‡§§‡•Å‡§Æ ‡§ñ‡•á‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•ã‡•§", "‡§§‡•Å‡§Æ ‡§ñ‡•á‡§≤‡§§‡§æ ‡§π‡•ã‡•§"], answer: "‡§§‡•Å‡§Æ ‡§ñ‡•á‡§≤ ‡§∞‡§π‡•á ‡§π‡•ã‡•§" },
  { question: "‡§∏‡§π‡•Ä ‡§∂‡§¨‡•ç‡§¶ ‡§ö‡•Å‡§®‡•á‡§Ç: '‡§∏‡§Ç‡§¶‡•Ä‡§™ ____ ‡§ó‡§Ø‡§æ‡•§'", options: ["‡§∏‡•ç‡§ï‡•Ç‡§≤", "‡§∏‡•ç‡§ï‡•Ç‡§≤‡•Ä", "‡§∏‡•ç‡§ï‡•Ç‡§≤‡•ã‡§Ç"], answer: "‡§∏‡•ç‡§ï‡•Ç‡§≤" },
  { question: "‡§∏‡§π‡•Ä ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§ï‡§æ ‡§ö‡§Ø‡§® ‡§ï‡§∞‡•á‡§Ç:", options: ["‡§Æ‡•à‡§Ç‡§®‡•á ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§™‡§¢‡§º‡•Ä‡•§", "‡§Æ‡•à‡§Ç‡§®‡•á ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§™‡§¢‡§º‡§æ‡•§", "‡§Æ‡•à‡§Ç‡§®‡•á ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§™‡§¢‡§º‡§§‡•á‡•§"], answer: "‡§Æ‡•à‡§Ç‡§®‡•á ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§™‡§¢‡§º‡•Ä‡•§" },
  { question: "‡§∏‡§π‡•Ä ‡§∞‡•Ç‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç: '‡§µ‡•á ‡§≤‡•ã‡§ó ____ ‡§Ü‡§è‡•§'", options: ["‡§Æ‡•á‡§≤‡•á", "‡§Æ‡•á‡§≤‡§æ", "‡§Æ‡•á‡§≤‡•ã‡§Ç"], answer: "‡§Æ‡•á‡§≤‡§æ" },
  { question: "‡§∏‡§π‡•Ä ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç: '‡§∞‡§Æ‡•á‡§∂ ‡§®‡•á ‡§ï‡§≤ ____ ‡§ñ‡•á‡§≤‡§æ‡•§'", options: ["‡§ñ‡•á‡§≤", "‡§ñ‡•á‡§≤‡•á‡§Ç", "‡§ñ‡•á‡§≤‡•ã‡§Ç"], answer: "‡§ñ‡•á‡§≤" }
];

let questions = level1;
let score = 0;
let currentQuestion = 0;
const gameArea = document.getElementById("gameArea");
const scoreEl = document.getElementById("score");
const messageEl = document.getElementById("message");

function startGame() {
  document.getElementById("intro").style.display = "none";
  gameArea.style.display = "block";
  document.getElementById("controls").style.display = "block";
  currentQuestion = 0;
  score = 0;
  scoreEl.innerText = "Score: " + score;
  showQuestion();
}

function stopGame(){
  messageEl.innerText = `‚èπÔ∏è ‡§ñ‡•á‡§≤ ‡§∞‡•ã‡§ï ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!\nFinal Score: ${score}`;
  gameArea.innerHTML = "";
}

function backToIntro(){
  document.getElementById("intro").style.display = "block";
  gameArea.style.display = "none";
  document.getElementById("controls").style.display = "none";
  score = 0;
  scoreEl.innerText = "Score: 0";
  messageEl.innerText = "";
  questions = level1; // Reset to level 1
}

function restartLevel(){
  score = 0;
  currentQuestion = 0;
  scoreEl.innerText = "Score: 0";
  showQuestion();
}

function showQuestion() {
  gameArea.innerHTML = "";
  messageEl.innerText = "";

  if(currentQuestion >= questions.length){
    gameArea.innerHTML = "";
    messageEl.style.color = "#1b5e20";
    messageEl.style.fontSize = "28px";
    messageEl.innerText = `üéâ Game Over!\n‡§Ü‡§™‡§ï‡§æ Final Score: ${score}\n‡§Ü‡§™‡§®‡•á Grammar ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§ø‡§è! ‚úÖ`;

    // Buttons container
    const btnContainer = document.createElement("div");
    btnContainer.style.marginTop = "20px";

    // Restart button
    const restartBtn = document.createElement("button");
    restartBtn.innerText = "üîÑ Restart Game";
    restartBtn.style.padding = "12px 25px";
    restartBtn.style.margin = "10px";
    restartBtn.style.fontSize = "18px";
    restartBtn.style.background = "#d32f2f";
    restartBtn.style.color = "white";
    restartBtn.style.border = "none";
    restartBtn.style.borderRadius = "10px";
    restartBtn.style.cursor = "pointer";
    restartBtn.onclick = startGame;

    // Next Level button
    const nextBtn = document.createElement("button");
    nextBtn.innerText = "‚è≠ Next Level";
    nextBtn.style.padding = "12px 25px";
    nextBtn.style.margin = "10px";
    nextBtn.style.fontSize = "18px";
    nextBtn.style.background = "#388e3c";
    nextBtn.style.color = "white";
    nextBtn.style.border = "none";
    nextBtn.style.borderRadius = "10px";
    nextBtn.style.cursor = "pointer";
    nextBtn.onclick = ()=> {
      questions = level2;
      score = 0;
      currentQuestion = 0;
      scoreEl.innerText = "Score: 0";
      messageEl.innerText = "";
      showQuestion();
    };

    btnContainer.appendChild(restartBtn);
    btnContainer.appendChild(nextBtn);
    gameArea.appendChild(btnContainer);

    return;
  }

  const q = questions[currentQuestion];
  const questionDiv = document.createElement("div");
  questionDiv.style.fontSize = "20px";
  questionDiv.style.marginBottom = "15px";
  questionDiv.innerText = q.question;
  gameArea.appendChild(questionDiv);

  const lanes = [50, 200, 350];
  q.options.forEach((opt,index)=>{
    const bubble = document.createElement("div");
    bubble.classList.add("bubble");
    bubble.style.top = lanes[index]+"px";
    bubble.style.left = Math.random() * 600 + "px";
    bubble.innerText = opt;
    gameArea.appendChild(bubble);

    let posX = parseInt(bubble.style.left);
    const move = setInterval(()=>{
      posX += Math.random()*2;
      if(posX > 700) posX = -120;
      bubble.style.left = posX + "px";
    },30);

    bubble.onclick = ()=>{
      clearInterval(move);
      if(opt === q.answer){
        score +=10;
        messageEl.innerText = "‚úÖ ‡§∏‡§π‡•Ä!";
      } else {
        score -=5;
        messageEl.innerText = "‚ùå ‡§ó‡§≤‡§§!";
      }
      scoreEl.innerText = "Score: "+score;
      currentQuestion++;
      setTimeout(showQuestion, 1000);
    }
  });
}
</script>
{% endblock %}
